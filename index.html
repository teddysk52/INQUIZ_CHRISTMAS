<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INQUIZ üéÑ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #0a1628 0%, #1a2a4a 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 20px;
        }

        /* –õ–û–ë–ë–ò */
        #lobby {
            text-align: center;
            padding: 50px 20px;
        }

        .input-field {
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #ffd700;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            width: 300px;
            margin: 10px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
        }

        .btn-green {
            background: #22c55e;
            color: #fff;
        }

        .btn-red {
            background: #ef4444;
            color: #fff;
        }

        .btn-gray {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .teams-list {
            margin: 30px auto;
            max-width: 500px;
        }

        .team-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            font-size: 1.2rem;
        }

        /* –ò–ì–†–ê */
        #game {
            display: none;
        }

        .scoreboard {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .team-card {
            background: rgba(255,255,255,0.1);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 15px 25px;
            min-width: 150px;
            text-align: center;
        }

        .team-card.active {
            border-color: #3b82f6;
            box-shadow: 0 0 30px rgba(59,130,246,0.5);
        }

        .team-card.answering {
            border-color: #22c55e;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .team-name {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 5px;
        }

        .team-score {
            font-size: 2rem;
            font-weight: 900;
            color: #ffd700;
        }

        .info-banner {
            text-align: center;
            padding: 15px;
            background: rgba(59,130,246,0.2);
            border: 2px solid #3b82f6;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .category {
            background: linear-gradient(145deg, #c41e3a, #8b0000);
            padding: 20px 10px;
            text-align: center;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell {
            background: linear-gradient(145deg, #1e5128, #2d7a3a);
            border: 2px solid rgba(255,255,255,0.2);
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            font-weight: 900;
            font-size: 1.5rem;
            color: #ffd700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .cell:hover:not(.used) {
            transform: scale(1.05);
            border-color: #ffd700;
        }

        .cell.used {
            background: rgba(50,50,50,0.5);
            color: rgba(255,255,255,0.2);
            cursor: not-allowed;
        }

        /* –ú–û–î–ê–õ–ö–ê */
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #modal.show {
            display: flex;
        }

        .modal-box {
            background: linear-gradient(145deg, #1a2a4a, #0a1628);
            border: 3px solid rgba(255,215,0,0.3);
            border-radius: 25px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            text-align: center;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-pts {
            font-size: 4rem;
            font-weight: 900;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 3rem;
            font-weight: 900;
            color: #4ade80;
            margin-bottom: 20px;
        }

        .timer.warning { color: #fbbf24; }
        .timer.danger { color: #ef4444; }

        .question {
            font-size: 1.8rem;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .buzz-btn {
            width: 180px;
            height: 180px;
            background: linear-gradient(145deg, #ef4444, #dc2626);
            border: 5px solid #ffd700;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: 900;
            color: #fff;
            cursor: pointer;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(239,68,68,0.4);
        }

        .buzz-btn:hover:not(.disabled) {
            transform: scale(1.1);
        }

        .buzz-btn.disabled {
            background: rgba(100,100,100,0.5);
            border-color: rgba(255,255,255,0.2);
            cursor: not-allowed;
        }

        .answer-input {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            font-size: 1.5rem;
            text-align: center;
            background: rgba(255,255,255,0.1);
            border: 3px solid #ffd700;
            border-radius: 15px;
            color: #fff;
            margin-bottom: 20px;
        }

        .result {
            font-size: 2rem;
            font-weight: 900;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .result.correct {
            background: rgba(34,197,94,0.2);
            border: 3px solid #22c55e;
            color: #22c55e;
        }

        .result.wrong {
            background: rgba(239,68,68,0.2);
            border: 3px solid #ef4444;
            color: #ef4444;
        }

        .hidden { display: none !important; }

        .admin-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .board { gap: 5px; }
            .category { font-size: 0.7rem; padding: 10px 5px; min-height: 60px; }
            .cell { padding: 15px; font-size: 1.2rem; }
            .modal-box { padding: 30px 20px; }
            .question { font-size: 1.3rem; }
            .buzz-btn { width: 150px; height: 150px; }
        }
    </style>
</head>
<body>
    <button class="admin-btn" onclick="adminReset()">‚öôÔ∏è</button>

    <!-- –õ–û–ë–ë–ò -->
    <div id="lobby">
        <h1>üéÑ INQUIZ üéÑ</h1>
        <h2>V√°noƒçn√≠ Speci√°l</h2>
        
        <input type="text" id="teamInput" class="input-field" placeholder="N√°zev t√Ωmu..." maxlength="20">
        <br>
        <button class="btn btn-green" onclick="addTeam()">‚ûï P≈ôidat t√Ωm</button>
        
        <div class="teams-list" id="teamsList"></div>
        
        <input type="password" id="passInput" class="input-field" placeholder="Heslo (6952)" maxlength="4" style="width: 200px;">
        <br>
        <button class="btn btn-red" onclick="startGame()">üöÄ ZAƒå√çT HRU</button>
        <br>
        <button class="btn btn-gray" onclick="clearAll()">üóëÔ∏è Vymazat v≈°e</button>
    </div>

    <!-- –ò–ì–†–ê -->
    <div id="game" class="container">
        <h1>üéÑ INQUIZ üéÑ</h1>
        
        <div id="infoBanner" class="info-banner"></div>
        <div id="scoreboard" class="scoreboard"></div>
        <div id="board" class="board"></div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê -->
    <div id="modal">
        <div class="modal-box">
            <div class="close-btn" onclick="closeQuestion()">‚úï</div>
            <div class="modal-pts" id="modalPts"></div>
            <div class="timer" id="timer">20</div>
            <div class="question" id="question"></div>
            
            <div id="answeringInfo" class="hidden">
                Odpov√≠d√°: <strong id="answeringTeam"></strong>
            </div>
            
            <button class="buzz-btn" id="buzzBtn" onclick="buzz()">üîî<br>ODPOVƒöDƒöT</button>
            
            <div id="answerSection" class="hidden">
                <input type="text" id="answerInput" class="answer-input" placeholder="Va≈°e odpovƒõƒè...">
                <br>
                <button class="btn btn-green" onclick="submitAnswer()">Odeslat</button>
            </div>
            
            <div id="result" class="result hidden"></div>
            <div id="correctAnswer" class="hidden" style="margin-top: 20px; color: #4ade80; font-size: 1.2rem;"></div>
        </div>
    </div>

    <script>
        // Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDwo2GKOXEDDs31kRfFCQLy_TcXRC2DF0",
            authDomain: "inquiz-a82e2.firebaseapp.com",
            databaseURL: "https://inquiz-a82e2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "inquiz-a82e2",
            storageBucket: "inquiz-a82e2.firebasestorage.app",
            messagingSenderId: "943129879818",
            appId: "1:943129879818:web:366e32fe072182cd0d86f3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('game3');

        // –í–æ–ø—Ä–æ—Å—ã
        const Q = {
            1: {
                "Minecraft üéÆ": [
                    {q: "Jak se jmenuje hlavn√≠ boss?", a: ["ender dragon", "enderdragon"]},
                    {q: "Kolik blok≈Ø obsidi√°nu na port√°l?", a: ["10", "deset"]},
                    {q: "Dimenze s Endermany?", a: ["the end", "end"]},
                    {q: "ƒå√≠m ochoƒç√≠≈° vlka?", a: ["kost", "bone"]},
                    {q: "Rok vyd√°n√≠ Minecraft 1.0?", a: ["2011"]}
                ],
                "IT üíª": [
                    {q: "Chyba v k√≥du?", a: ["bug", "chyba"]},
                    {q: "Jazyk pojmenovan√Ω po k√°vƒõ?", a: ["java"]},
                    {q: "Co znamen√° HTML?", a: ["hypertext markup language"]},
                    {q: "Oper√°tor porovn√°n√≠?", a: ["=="]},
                    {q: "LIFO struktura?", a: ["stack", "z√°sobn√≠k"]}
                ],
                "Tech üñ•Ô∏è": [
                    {q: "Co je USB?", a: ["universal serial bus"]},
                    {q: "Kdo vytvo≈ôil iPhone?", a: ["apple"]},
                    {q: "Co je RAM?", a: ["pamƒõ≈•", "random access memory"]},
                    {q: "Rok zalo≈æen√≠ Google?", a: ["1998"]},
                    {q: "Bezpeƒçn√Ω protokol webu?", a: ["https"]}
                ],
                "Memes üòÇ": [
                    {q: "Vtipn√Ω obr√°zek na netu?", a: ["meme"]},
                    {q: "Koƒçka u stolu?", a: ["woman yelling at cat"]},
                    {q: "Co je rickrolling?", a: ["rick astley", "never gonna give you up"]},
                    {q: "Pes Doge?", a: ["shiba", "shiba inu"]},
                    {q: "Co je LOL?", a: ["laughing out loud", "lol"]}
                ],
                "V√°noce üéÑ": [
                    {q: "Sob s ƒçerven√Ωm nosem?", a: ["rudolf"]},
                    {q: "Zemƒõ v√°noƒçn√≠ho stromku?", a: ["nƒõmecko", "germany"]},
                    {q: "N√°poj z ml√©ka a vajec?", a: ["eggnog"]},
                    {q: "Kolik sob≈Ø (bez Rudolfa)?", a: ["8", "osm"]},
                    {q: "Kalend√°≈ô s ok√©nky?", a: ["adventn√≠", "advent"]}
                ]
            }
        };

        const PTS = [200, 400, 600, 800, 1000];

        // State
        let game = {};
        let myTeam = localStorage.getItem('myTeam') || '';
        let timer = null;

        // Init
        db.on('value', s => {
            const data = s.val();
            if (data) {
                game = data;
                render();
            }
        });

        function save() {
            db.set(game);
        }

        function render() {
            if (!game.started) {
                document.getElementById('lobby').style.display = 'block';
                document.getElementById('game').style.display = 'none';
                document.getElementById('modal').classList.remove('show');
                renderTeamsList();
            } else {
                document.getElementById('lobby').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                renderScoreboard();
                renderBoard();
                
                if (game.current) {
                    showModal();
                } else {
                    document.getElementById('modal').classList.remove('show');
                    stopTimer();
                }
            }
        }

        // –õ–û–ë–ë–ò
        function renderTeamsList() {
            const list = document.getElementById('teamsList');
            if (!game.teams || game.teams.length === 0) {
                list.innerHTML = '<div style="color: rgba(255,255,255,0.5)">≈Ω√°dn√© t√Ωmy...</div>';
                return;
            }
            list.innerHTML = game.teams.map((t, i) => 
                `<div class="team-item">${i+1}. ${t.name} - ${t.score} bod≈Ø</div>`
            ).join('');
        }

        function addTeam() {
            const input = document.getElementById('teamInput');
            const name = input.value.trim();
            if (!name) return alert('Zadejte n√°zev!');
            
            if (!game.teams) game.teams = [];
            if (game.teams.some(t => t.name === name)) return alert('U≈æ existuje!');
            
            game.teams.push({name, score: 0});
            myTeam = name;
            localStorage.setItem('myTeam', name);
            input.value = '';
            save();
        }

        function clearAll() {
            const pass = prompt('Heslo:');
            if (pass !== '6952') return;
            game = {started: false, teams: [], used: []};
            myTeam = '';
            localStorage.removeItem('myTeam');
            save();
        }

        function startGame() {
            const pass = document.getElementById('passInput').value;
            if (pass !== '6952') return alert('≈†patn√© heslo!');
            if (!game.teams || game.teams.length === 0) return alert('P≈ôidejte t√Ωmy!');
            
            game.started = true;
            game.round = 1;
            game.used = [];
            game.current = null;
            game.activeTeam = Math.floor(Math.random() * game.teams.length);
            save();
        }

        // –ò–ì–†–ê
        function renderScoreboard() {
            const sb = document.getElementById('scoreboard');
            sb.innerHTML = game.teams.map((t, i) => {
                let cls = 'team-card';
                if (game.activeTeam === i && !game.current) cls += ' active';
                if (game.answering === i) cls += ' answering';
                return `<div class="${cls}">
                    <div class="team-name">${t.name}</div>
                    <div class="team-score">${t.score}</div>
                </div>`;
            }).join('');

            const info = document.getElementById('infoBanner');
            if (game.activeTeam !== null && !game.current) {
                info.style.display = 'block';
                info.innerHTML = `<strong>${game.teams[game.activeTeam].name}</strong> vyb√≠r√° ot√°zku`;
            } else {
                info.style.display = 'none';
            }
        }

        function renderBoard() {
            const cats = Object.keys(Q[game.round || 1]);
            let html = cats.map(c => `<div class="category">${c}</div>`).join('');
            
            PTS.forEach((pts, row) => {
                cats.forEach((cat, col) => {
                    const id = `${game.round}-${col}-${row}`;
                    const used = game.used && game.used.includes(id);
                    html += `<div class="cell ${used ? 'used' : ''}" onclick="openQ('${cat}', ${row})">${pts}</div>`;
                });
            });
            
            document.getElementById('board').innerHTML = html;
        }

        // –í–û–ü–†–û–°
        function openQ(cat, idx) {
            if (game.current) return;
            
            const cats = Object.keys(Q[game.round]);
            const catIdx = cats.indexOf(cat);
            const id = `${game.round}-${catIdx}-${idx}`;
            
            if (game.used && game.used.includes(id)) return;
            
            const myIdx = game.teams.findIndex(t => t.name === myTeam);
            if (game.activeTeam !== null && myIdx !== game.activeTeam) {
                return alert('Nen√≠ va≈°e ≈ôada!');
            }
            
            const q = Q[game.round][cat][idx];
            game.current = {
                id,
                pts: PTS[idx],
                q: q.q,
                a: q.a
            };
            game.answering = null;
            game.tried = [];
            game.timerStart = Date.now();
            save();
        }

        function showModal() {
            document.getElementById('modalPts').textContent = game.current.pts;
            document.getElementById('question').textContent = game.current.q;
            document.getElementById('result').className = 'result hidden';
            document.getElementById('correctAnswer').className = 'hidden';
            document.getElementById('answerInput').value = '';
            
            updateBuzzState();
            document.getElementById('modal').classList.add('show');
            startTimer();
        }

        function updateBuzzState() {
            const myIdx = game.teams.findIndex(t => t.name === myTeam);
            const buzzBtn = document.getElementById('buzzBtn');
            const answerSection = document.getElementById('answerSection');
            const info = document.getElementById('answeringInfo');
            
            if (game.answering !== null && game.answering !== undefined) {
                buzzBtn.classList.add('disabled');
                info.classList.remove('hidden');
                document.getElementById('answeringTeam').textContent = game.teams[game.answering].name;
                
                if (game.answering === myIdx) {
                    answerSection.classList.remove('hidden');
                    setTimeout(() => document.getElementById('answerInput').focus(), 100);
                } else {
                    answerSection.classList.add('hidden');
                }
            } else {
                info.classList.add('hidden');
                answerSection.classList.add('hidden');
                
                if (myIdx === -1 || (game.tried && game.tried.includes(myIdx))) {
                    buzzBtn.classList.add('disabled');
                } else {
                    buzzBtn.classList.remove('disabled');
                }
            }
        }

        function buzz() {
            const myIdx = game.teams.findIndex(t => t.name === myTeam);
            if (myIdx === -1) return;
            if (game.answering !== null) return;
            if (game.tried && game.tried.includes(myIdx)) return;
            
            game.answering = myIdx;
            if (!game.tried) game.tried = [];
            game.tried.push(myIdx);
            save();
        }

        function submitAnswer() {
            const myIdx = game.teams.findIndex(t => t.name === myTeam);
            if (game.answering !== myIdx) return;
            
            const input = document.getElementById('answerInput').value.trim().toLowerCase();
            if (!input) return;
            
            const correct = game.current.a.some(a => {
                const ans = a.toLowerCase();
                return input === ans || input.includes(ans) || ans.includes(input);
            });
            
            const result = document.getElementById('result');
            
            if (correct) {
                result.textContent = '‚úÖ SPR√ÅVNƒö!';
                result.className = 'result correct';
                game.teams[myIdx].score += game.current.pts;
                game.activeTeam = myIdx;
                
                if (!game.used) game.used = [];
                game.used.push(game.current.id);
                save();
                
                setTimeout(() => {
                    game.current = null;
                    game.answering = null;
                    game.tried = [];
                    save();
                }, 2000);
            } else {
                result.textContent = '‚ùå ≈†PATNƒö!';
                result.className = 'result wrong';
                game.teams[myIdx].score -= game.current.pts;
                game.answering = null;
                game.timerStart = Date.now();
                save();
                
                setTimeout(() => {
                    result.className = 'result hidden';
                    if (game.tried && game.tried.length >= game.teams.length) {
                        showCorrect();
                    }
                }, 1500);
            }
        }

        function showCorrect() {
            stopTimer();
            document.getElementById('buzzBtn').classList.add('disabled');
            document.getElementById('answerSection').classList.add('hidden');
            
            const ca = document.getElementById('correctAnswer');
            ca.textContent = 'Spr√°vn√° odpovƒõƒè: ' + game.current.a[0];
            ca.classList.remove('hidden');
            
            if (!game.used) game.used = [];
            game.used.push(game.current.id);
            save();
            
            setTimeout(() => {
                game.current = null;
                game.answering = null;
                game.tried = [];
                save();
            }, 3000);
        }

        function closeQuestion() {
            const pass = prompt('Heslo:');
            if (pass !== '6952') return;
            
            if (game.current) {
                if (!game.used) game.used = [];
                game.used.push(game.current.id);
            }
            game.current = null;
            game.answering = null;
            game.tried = [];
            save();
        }

        // –¢–ê–ô–ú–ï–†
        function startTimer() {
            stopTimer();
            timer = setInterval(updateTimer, 100);
        }

        function updateTimer() {
            if (!game.timerStart || !game.current) return;
            
            const elapsed = Math.floor((Date.now() - game.timerStart) / 1000);
            const remaining = Math.max(0, 20 - elapsed);
            
            const t = document.getElementById('timer');
            t.textContent = remaining;
            t.className = 'timer';
            if (remaining <= 5) t.className = 'timer danger';
            else if (remaining <= 10) t.className = 'timer warning';
            
            if (remaining <= 0) showCorrect();
        }

        function stopTimer() {
            if (timer) clearInterval(timer);
        }

        // –ê–î–ú–ò–ù
        function adminReset() {
            const pass = prompt('Admin heslo:');
            if (pass !== '6952') return;
            
            const cmd = prompt('reset - √∫pln√Ω reset\nlobby - zpƒõt do lobby');
            if (cmd === 'reset') {
                game = {started: false, teams: [], used: []};
                myTeam = '';
                localStorage.removeItem('myTeam');
                save();
            } else if (cmd === 'lobby') {
                game.started = false;
                game.current = null;
                save();
            }
        }

        // Enter
        document.getElementById('teamInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') addTeam();
        });
        document.getElementById('answerInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') submitAnswer();
        });
    </script>
</body>
</html>
